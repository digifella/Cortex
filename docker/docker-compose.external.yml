# Docker Compose override for external host storage mode.
#
# Usage:
#   docker compose --profile cpu -f docker-compose.yml -f docker-compose.external.yml up -d
#   docker compose --profile gpu -f docker-compose.yml -f docker-compose.external.yml up -d
#
# Required in .env:
#   EXTERNAL_AI_DATABASE_PATH=<host path>
# Optional in .env:
#   EXTERNAL_KNOWLEDGE_PATH=<host path>

version: '3.8'

services:
  cortex-suite-cpu:
    volumes:
      - type: bind
        source: ${EXTERNAL_AI_DATABASE_PATH:?Please set EXTERNAL_AI_DATABASE_PATH in .env}
        target: /data/ai_databases
      - type: bind
        source: ${EXTERNAL_KNOWLEDGE_PATH:-./knowledge_base}
        target: /data/knowledge_base
        read_only: true
      - ollama_data:/home/cortex/.ollama
      - cortex_logs:/home/cortex/app/logs

  cortex-suite-gpu:
    volumes:
      - type: bind
        source: ${EXTERNAL_AI_DATABASE_PATH:?Please set EXTERNAL_AI_DATABASE_PATH in .env}
        target: /data/ai_databases
      - type: bind
        source: ${EXTERNAL_KNOWLEDGE_PATH:-./knowledge_base}
        target: /data/knowledge_base
        read_only: true
      - ollama_data:/home/cortex/.ollama
      - cortex_logs:/home/cortex/app/logs

volumes:
  ollama_data:
    driver: local
  cortex_logs:
    driver: local
