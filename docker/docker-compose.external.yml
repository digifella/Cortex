# Docker Compose Override for External Storage Mode
#
# This override file enables external/host storage instead of containerized volumes.
# Use this when you want to:
#   - Access your databases from the host filesystem
#   - Use existing databases from a previous installation
#   - Easily backup data by copying folders
#
# USAGE:
#   docker compose -f docker-compose.yml -f docker-compose.external.yml up -d
#
# Or use the helper scripts:
#   Windows: run-cortex-external.bat
#   Linux/Mac: ./run-cortex-external.sh
#
# REQUIRED: Set these environment variables in your .env file:
#   EXTERNAL_AI_DATABASE_PATH=C:\ai_databases        (Windows)
#   EXTERNAL_AI_DATABASE_PATH=/mnt/f/ai_databases    (WSL/Linux)
#   EXTERNAL_KNOWLEDGE_PATH=C:\KB_Test               (Windows)
#   EXTERNAL_KNOWLEDGE_PATH=/mnt/e/KB_Test           (WSL/Linux)

version: '3.8'

services:
  # Override cortex-api volumes to use external storage
  cortex-api:
    volumes:
      - type: bind
        source: ${EXTERNAL_AI_DATABASE_PATH:?Please set EXTERNAL_AI_DATABASE_PATH in .env}
        target: /data/ai_databases
      - type: bind
        source: ${EXTERNAL_KNOWLEDGE_PATH:-./knowledge_base}
        target: /data/knowledge_base
        read_only: true
      - cortex_logs:/app/logs

  # Override cortex-ui volumes to use external storage
  cortex-ui:
    volumes:
      - type: bind
        source: ${EXTERNAL_AI_DATABASE_PATH:?Please set EXTERNAL_AI_DATABASE_PATH in .env}
        target: /data/ai_databases
      - type: bind
        source: ${EXTERNAL_KNOWLEDGE_PATH:-./knowledge_base}
        target: /data/knowledge_base
        read_only: true
      - cortex_logs:/app/logs

  # Override backup-service to use external storage
  backup-service:
    volumes:
      - type: bind
        source: ${EXTERNAL_AI_DATABASE_PATH:?Please set EXTERNAL_AI_DATABASE_PATH in .env}
        target: /data/ai_databases
        read_only: true
      - backup_data:/backups

volumes:
  cortex_logs:
    driver: local
  backup_data:
    driver: local
