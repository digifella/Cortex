[pytest]
# Pytest Configuration for Cortex Suite
# Version: 1.0.0
# Purpose: Configure pytest behavior, markers, and test discovery

# Test discovery patterns
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# Directories to search for tests
testpaths = tests

# Minimum Python version
minversion = 3.11

# Command line options applied by default
addopts =
    # Verbose output
    -v
    # Show summary of all test outcomes
    -ra
    # Show local variables in tracebacks
    --showlocals
    # Coverage reporting (uncomment after installing requirements-dev.txt)
    # --cov=cortex_engine
    # --cov=pages
    # --cov-report=html
    # --cov-report=term-missing
    # --cov-report=json
    # Fail if coverage is below 70% (aspirational, start lower)
    # --cov-fail-under=30
    # Strict markers - fail on unknown markers
    --strict-markers
    # Warnings
    -W ignore::DeprecationWarning
    -W ignore::PendingDeprecationWarning
    # Performance
    --durations=10

# Custom markers for test categorization
markers =
    unit: Unit tests - fast, isolated, no external dependencies
    integration: Integration tests - may require database, services, or file I/O
    ui: UI tests - Streamlit page testing
    slow: Tests that take more than 1 second
    requires_ollama: Tests requiring Ollama service to be running
    requires_models: Tests requiring specific AI models to be available
    requires_chromadb: Tests requiring ChromaDB
    requires_network: Tests requiring internet connection
    docker: Tests specific to Docker environment
    wsl: Tests specific to WSL environment
    security: Security-focused tests
    performance: Performance benchmarking tests

# Logging configuration
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# Timeout for tests (prevent hanging)
timeout = 300

# Parallel execution (install pytest-xdist)
# -n auto

# Coverage configuration
[coverage:run]
source = cortex_engine,pages
omit =
    */tests/*
    */test_*.py
    */__pycache__/*
    */venv/*
    */archive/*
    */docker/*
    */.venv/*

[coverage:report]
precision = 2
skip_empty = true
show_missing = true
exclude_lines =
    # Standard pragma
    pragma: no cover
    # Don't complain about missing debug code
    def __repr__
    # Don't complain if tests don't hit defensive assertion code
    raise AssertionError
    raise NotImplementedError
    # Don't complain about abstract methods
    @abstractmethod
    # Don't complain about type checking blocks
    if TYPE_CHECKING:
    # Don't complain about main blocks
    if __name__ == .__main__.:

[coverage:html]
directory = htmlcov
